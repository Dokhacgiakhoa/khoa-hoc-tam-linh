/* ======= Layout tổng ======= */
.tarot-wrapper {
  background: #fff;
  border-radius: 18px;
  padding: 24px;
}

.tarot-header {
  margin-bottom: 16px;
}

.tarot-subtitle {
  font-size: 0.9rem;
  color: #4b5563;
}

.tarot-body {
  display: flex;
  gap: 32px;
  align-items: flex-start;
}

/* ======= Bố cục 3 cột ======= */
.tarot-deck-col {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 16px;
  align-items: flex-start;
}

.tarot-card-col {
  flex: 1;
  display: flex;
  justify-content: center;
}

.tarot-content-col {
  flex: 3;
}

/* ======= Bộ bài nghiêng 3D ======= */
.tarot-deck {
  position: relative;
  width: 120px;
  aspect-ratio: 9/16;
  perspective: 1400px;
  transform-style: preserve-3d;
  transform: rotateY(-12deg) rotateX(5deg);
  cursor: pointer;
  overflow: visible;
}

.tarot-card {
  position: absolute;
  inset: 0;
  border-radius: 18px;
  overflow: hidden;
  background: #020617;
  box-shadow: 0 10px 32px rgba(15, 23, 42, 0.45);
  backface-visibility: hidden;
  transform-style: preserve-3d;
}

.tarot-card img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* lá 3–6 tạo độ dày + xoay nhẹ */
.tarot-card--3 {
  transform: translateZ(-18px) translateY(2px) rotateZ(-4deg);
  filter: brightness(0.7);
}
.tarot-card--4 {
  transform: translateZ(-14px) translateY(1px) rotateZ(-2deg);
  filter: brightness(0.78);
}
.tarot-card--5 {
  transform: translateZ(-10px) rotateZ(-1deg);
  filter: brightness(0.83);
}
.tarot-card--6 {
  transform: translateZ(-6px) rotateZ(-0.5deg);
  filter: brightness(0.9);
}

/* 1 & 2 chồng trên */
.tarot-card--1,
.tarot-card--2 {
  transform: translateZ(0) rotateZ(0deg);
}

/* 7 trùng 6 (dưới cùng) */
.tarot-card--7 {
  transform: translateZ(-6px) rotateZ(-0.5deg);
  opacity: 0;
}

/* thứ tự lớp */
.tarot-card--1 {
  z-index: 10;
}
.tarot-card--2 {
  z-index: 9;
}
.tarot-card--3 {
  z-index: 8;
}
.tarot-card--4 {
  z-index: 7;
}
.tarot-card--5 {
  z-index: 6;
}
.tarot-card--6 {
  z-index: 5;
}
.tarot-card--7 {
  z-index: 0;
}

/* ======= HIỆU ỨNG TRÁO BÀI (1 ↔ 7) ======= */
.is-shuffling .tarot-card--1 {
  animation: shuffleTopInstant 0.8s ease-in-out infinite;
}
.is-shuffling .tarot-card--7 {
  animation: shuffleBottomInstant 0.8s ease-in-out infinite;
}

/* Lá 1: đi ra, ẩn ngay, quay lại, hiện ngay */
@keyframes shuffleTopInstant {
  0%,
  100% {
    opacity: 1;
    transform: translateX(0) translateZ(0) rotateZ(0deg);
  }
  10% {
    opacity: 1;
    transform: translateX(60px) translateZ(10px) rotateZ(-4deg);
  }
  11% {
    opacity: 0;
    transform: translateX(60px) translateZ(10px) rotateZ(-4deg);
  }
  50% {
    opacity: 0;
    transform: translateX(120px) translateZ(20px) rotateZ(-6deg);
  }
  51% {
    opacity: 1;
    transform: translateX(120px) translateZ(20px) rotateZ(-6deg);
  }
}

/* Lá 7: xuất hiện đúng lúc lá 1 biến mất */
@keyframes shuffleBottomInstant {
  0%,
  100% {
    opacity: 0;
    transform: translateX(0) translateZ(-6px) rotateZ(-0.5deg);
  }
  10% {
    opacity: 0;
    transform: translateX(60px) translateZ(10px) rotateZ(-4deg);
  }
  11% {
    opacity: 1;
    transform: translateX(60px) translateZ(10px) rotateZ(-4deg);
  }
  50% {
    opacity: 1;
    transform: translateX(120px) translateZ(20px) rotateZ(-6deg);
  }
  51% {
    opacity: 0;
    transform: translateX(120px) translateZ(20px) rotateZ(-6deg);
  }
}

/* ======= Nút ======= */
.tarot-btn {
  background: #0b6dff;
  border: none;
  color: #fff;
  padding: 10px 22px;
  border-radius: 12px;
  font-weight: 500;
  cursor: pointer;
  transition: transform 0.1s ease;
}
.tarot-btn:active {
  transform: translateY(1px);
}

/* ======= Lá kết quả ======= */
.tarot-card-flip {
  position: relative;
  width: 280px;
  aspect-ratio: 9/16;
  transform-style: preserve-3d;
  transition: transform 0.6s ease;
}
.tarot-card-flip.is-flipping {
  transform: rotateY(180deg);
}
.tarot-card-face {
  position: absolute;
  inset: 0;
  border-radius: 22px;
  overflow: hidden;
  backface-visibility: hidden;
  box-shadow: 0 18px 40px rgba(15, 23, 42, 0.25);
}
.tarot-card-back {
  transform: rotateY(180deg);
}
.tarot-card-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}
.tarot-card-img.rotate-180 {
  transform: rotate(180deg);
}

/* ======= LÁ BAY (định vị bằng JS) ======= */
.tarot-fly-card {
  position: absolute;
  width: 120px;
  aspect-ratio: 9 / 16;
  border-radius: 18px;
  overflow: hidden;
  animation: tarotFlyVar 0.6s ease-out forwards;
  pointer-events: none;
  z-index: 200;
  transform-origin: center center;
  box-shadow: 0 14px 28px rgba(0, 0, 0, 0.35);
}
.tarot-fly-card img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* bay từ tâm deck -> tâm lá kết quả */
@keyframes tarotFlyVar {
  0% {
    transform: translate(-50%, -50%) rotateY(-12deg) scale(1);
    opacity: 1;
  }
  50% {
    transform: translate(
        calc(var(--tx) * 0.55 - 50%),
        calc(var(--ty) * 0.55 - 50%)
      )
      rotateY(-4deg) scale(calc(1 + (var(--scale) - 1) * 0.5));
    opacity: 1;
  }
  100% {
    transform: translate(calc(var(--tx) - 50%), calc(var(--ty) - 50%))
      rotateY(0deg) scale(var(--scale));
    opacity: 0;
  }
}

/* ======= Nội dung ======= */
.tarot-card-title {
  font-size: 1.25rem;
  font-weight: 600;
  margin-bottom: 6px;
}
.tarot-card-meaning {
  color: #374151;
  line-height: 1.6;
  max-width: 520px;
}

/* ======= Responsive ======= */
@media (max-width: 1024px) {
  .tarot-body {
    flex-wrap: wrap;
  }
  .tarot-deck-col,
  .tarot-card-col,
  .tarot-content-col {
    flex: 1 1 100%;
  }
  .tarot-card-col {
    justify-content: flex-start;
  }
}
